set-option -g default-terminal "tmux-256color"

set-option -g base-index 1        # Count windows from 1
set-option -g allow-rename off    # don't rename windows automatically
set-option -s escape-time 0       # address vim mode switching delay

set-option -g status-position     top
set-option -g status-style        'bg=#6A66CF,fg=white,bold,italics'
set-option -g status-left-length  40
set-option -g status-left         ' #[fg=yellow,bold,italics]#S #[fg=magenta]ยง '
set-option -g status-right        "#[fg=yellow,bold,italics]$USER@#h #[fg=magenta]%l:%M %P#{systtum_status} "

set-option -ga pane-active-border-style bg=default,fg=yellow

set-window-option -g mode-keys vi # Use vi keys for moving around the window

# Slightly more useful width in "main-vertical" layout; enough room for 3-digit
# line number gutter in Vim + 80 columns of text + 1 column breathing room
# (default looks to be about 79).
set-option -w -g main-pane-width 85

# Open new/split panes with the path of the current pane.
bind-key n new-window -c '#{pane_current_path}'
bind-key ! split-window -h -c '#{pane_current_path}'
bind-key - split-window -v -c '#{pane_current_path}'

bind-key r source-file ~/.tmux.conf
bind-key t select-layout main-vertical

# list sessions
bind-key w split-window -v "tmux list-sessions |\
                            sed -E 's/:.*$//' |\
                            grep -v \"^$(tmux display-message -p '#S')\$\" |\
                            fzf --reverse |\
                            xargs tmux switch-client -t"

# Kill a session
bind-key K run-shell 'tmux switch-client -n \;\
                      kill-session -t "$(tmux display-message -p "#S")" ||\
                      tmux kill-session'

# Ask for gpg password to allow mail to continue syncing
bind-key S run-shell 'tmux split-window -h \; resize-pane -Z \;\
  send-keys "gpg -q --for-your-eyes-only -d ~/.mailpass.personal.gpg" Enter'

bind-key -T copy-mode-vi 'v' send -X begin-selection
# Send buffer to local clipboard
# ~/.local/bin/ctcopy
bind-key -T copy-mode-vi 'y' send-keys -X copy-pipe-and-cancel "ctcopy"
# Send buffer to Clipper clipboard
# https://github.com/wincent/clipper
bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "nc -N localhost 8377"
# Set buffer from local clipboard
# ~/.local/bin/ctpaste
bind-key C-p run "ctpaste | tmux load-buffer - ;"

# Smart pane switching with awareness of Vim splits.
# See: https://github.com/christoomey/vim-tmux-navigator
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
  | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
  bind-key -n C-h if-shell "$is_vim" "send-keys C-h"  "select-pane -L"
  bind-key -n C-j if-shell "$is_vim" "send-keys C-j"  "select-pane -D"
  bind-key -n C-k if-shell "$is_vim" "send-keys C-k"  "select-pane -U"
  bind-key -n C-l if-shell "$is_vim" "send-keys C-l"  "select-pane -R"
  bind-key -n C-\ if-shell "$is_vim" "send-keys C-\\" "select-pane -l"
  bind-key -T copy-mode-vi C-h select-pane -L
  bind-key -T copy-mode-vi C-j select-pane -D
  bind-key -T copy-mode-vi C-k select-pane -U
  bind-key -T copy-mode-vi C-l select-pane -R
  bind-key -T copy-mode-vi C-\ select-pane -l

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

set -g @systtum-name 'mbsync.service'

set -g @continuum-save-interval '5'
set -g @continuum-restore 'on'

set -g @resurrect-strategy-vim 'session'

# Install TMUX plugin manager if not already installed
if "test ! -d ~/.tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && ~/.tmux/plugins/tpm/bin/install_plugins'"

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run -b '~/.tmux/plugins/tpm/tpm'
run -b '~/src/tmux-systtum-status/tmux-systtum-status.tmux'
